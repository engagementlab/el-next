version: '3'

services:
  reverse-proxy:
    # The official v2 Traefik docker image
    image: traefik:v2.9
    ports:
      - 443:443
      - 80:80
      - 8080:8080
    volumes:
      # So that Traefik can listen to the Docker events
      - /var/run/docker.sock:/var/run/docker.sock
      - ./proxy/traefik.yml:/traefik.yml
      - ./proxy/certs.yml:/certs.yml
      - /etc/ssl/certs:/certs
    networks:
      - web
    labels:
      - "traefik.http.routers.dashboard.rule=(PathPrefix(`/api`) || PathPrefix(`/dashboard`))"
      - "traefik.http.routers.dashboard.tls=true"
      # - "traefik.http.routers.dashboard.service=api@internal"
    restart: always

  cms-tngvi:
    # network_mode: host
    image: el-next
    env_file:
      - ./apps/cms/.env
    environment:
      - APP_NAME=tngvi
      - PORT=3000
    networks:
      - web
    ports:
      - 3000:3000
    labels:
      - traefik.http.routers.cms-tngvi.rule=Host(`tngvi.localhost`)
      # cms-sjm:
      #   image: el-next
      #   env_file:
      #     - ./apps/cms/.env
      #   environment:
      #     - APP_NAME=sjm
      #     - PORT=3001
      #   labels:
      #     - "traefik.http.routers.cms.rule=Host(`sjm.localhost`)"


networks:
  web:
    driver: bridge
    ipam:
      driver: default
